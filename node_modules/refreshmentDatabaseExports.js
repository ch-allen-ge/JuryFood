var exports = module.exports = {};
var conversions = require('conversionExports.js');
var mysql = require('mysql');
var emailer = require('refreshmentEmailExports.js');

exports.updateDatabase = function(info) {
	var connection = mysql.createConnection({
	  	host     : 'SAppD',
	  	user     : 'perdomo',
	  	password : 'password1',
	  	database : 'jury_food'
	});

	connection.connect();	

	var refreshmentReq = {				  
		delivery_date : info.year + '-' + conversions.twoDigitMonth(info.month) + '-' + info.day,
		quantity :info.quantity,
		date_entered: new Date(),
		last_modified: new Date()
	}

	var runQuery = function() {
		connection.query('INSERT INTO jury_food_refreshments SET ?', refreshmentReq ,function(err, result) {		  
			emailer.sendEmail(info, result.insertId); 
			if (err) {
				console.log(err);
			} else {
				console.log(result); 
			}		
		});
	};

	runQuery();

	console.log('Processed Refreshment');

	//window.location = "/html/successPage.html";			  		
}; //end updateDatabase function
